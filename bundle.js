/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,r){if(console.log("开始解析字幕，格式: ".concat(r)),console.log("字幕内容前50个字符: ".concat((t||"").substring(0,50),"...")),!t)return console.error("字幕内容为空"),{format:r||"unknown",entries:[]};"string"!=typeof t&&(console.error("字幕内容不是字符串类型:",n(t)),t=String(t));try{if((!r||"srt"!==r&&"ass"!==r&&"ssa"!==r)&&(t.includes("[Script Info]")||t.includes("[V4+ Styles]")?(r="ass",console.log("自动检测到ASS格式")):(r="srt",console.log("默认使用SRT格式"))),"srt"===r)return function(t){var r,n=[],o=e(t.trim().split(/\r?\n\r?\n/));try{for(o.s();!(r=o.n()).done;){var i=r.value.split(/\r?\n/);if(!(i.length<3)){var a=i[1],c=i.slice(2),s=a.match(/(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/);s&&n.push({startTime:s[1],endTime:s[2],text:c.join("\n")})}}}catch(t){o.e(t)}finally{o.f()}return{format:"srt",entries:n}}(t);if("ass"===r||"ssa"===r)return function(t){var r,n,o=[],a=!1,c=null,s=-1,u=-1,l=-1,f=e(t.split(/\r?\n/));try{for(f.s();!(r=f.n()).done;){var h=r.value;if("[Events]"!==h.trim()){if(a){if(h.startsWith("Format:")){s=(c=h.substring(7).split(",").map((function(t){return t.trim()}))).indexOf("Text"),u=c.indexOf("Start"),l=c.indexOf("End");continue}if(c&&h.startsWith("Dialogue:")){var d=i(h.substring(9));d.length>Math.max(s,u,l)&&o.push({startTime:d[u],endTime:d[l],text:(n=d[s],n.replace(/{[^}]*}/g,""))})}}}else a=!0}}catch(t){f.e(t)}finally{f.f()}return{format:"ass",entries:o}}(t)}catch(t){return console.error("解析字幕出错:",t),{format:r||"unknown",entries:[],error:t.message}}return console.warn("不支持的字幕格式: ".concat(r,"，返回空结果")),{format:r||"unknown",entries:[]}}function i(t){for(var e=[],r=!1,n="",o=0;o<t.length;o++){var i=t[o];","!==i||r?('"'===i&&(r=!r),n+=i):(e.push(n.trim()),n="")}return n&&e.push(n.trim()),e}function a(t){var e=document.getElementById("subtitle-preview");if(e.innerHTML="",!t||!t.entries||0===t.entries.length){var r=document.createElement("div");return r.classList.add("subtitle-error"),t&&t.error?r.textContent="解析字幕时出错: ".concat(t.error):r.textContent="未找到有效的字幕内容",void e.appendChild(r)}if(console.log("渲染字幕预览，共 ".concat(t.entries.length," 条字幕")),t.entries.slice(0,100).forEach((function(t,r){try{var n=document.createElement("div");n.classList.add("subtitle-entry");var o=document.createElement("div");o.classList.add("time-code"),o.textContent="".concat(t.startTime||"00:00:00"," --\x3e ").concat(t.endTime||"00:00:00");var i=document.createElement("div");i.classList.add("subtitle-text"),i.textContent=t.text||"[空白字幕]",n.appendChild(o),n.appendChild(i),e.appendChild(n)}catch(e){console.error("渲染第 ".concat(r+1," 条字幕时出错:"),e,t)}})),t.entries.length>100){var n=document.createElement("div");n.classList.add("more-subtitles"),n.textContent="仅显示前100条字幕，共".concat(t.entries.length,"条"),e.appendChild(n)}}function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function s(){s=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(e,r,n,o){var i=r&&r.prototype instanceof p?r:p,a=Object.create(i.prototype);return l(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=k(c,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var u=h(e,r,n);if("normal"===u.type){if(o=n.done?4:2,u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=4,n.method="throw",n.arg=u.arg)}}}(e,n,new O(o||[])),!0),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var d={};function p(){}function y(){}function m(){}var v={};l(v,i,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(j([])));b&&b!==r&&n.call(b,i)&&(v=b);var w=m.prototype=p.prototype=Object.create(v);function x(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(o,i,a,s){var u=h(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==c(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;l(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function k(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=h(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function I(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(I,this),this.reset(!0)}function j(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(c(e)+" is not iterable")}return y.prototype=m,l(w,"constructor",m),l(m,"constructor",y),y.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(w),t},e.awrap=function(t){return{__await:t}},x(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(w),l(w,u,"Generator"),l(w,i,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],c=this.prev,s=i[1],u=i[2];if(-1===i[0])return n("end"),!1;if(!s&&!u)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=c){if(c<s)return this.method="next",this.arg=t,n(s),!0;if(c<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],d):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:j(e),r,n},"next"===this.method&&(this.arg=t),d}},e}function u(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function l(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){u(i,n,o,a,c,"next",t)}function c(t){u(i,n,o,a,c,"throw",t)}a(void 0)}))}}t.d({},{X:()=>M});var f="http://localhost:3000";function h(t){var e=document.getElementById("subtitle-track-list");e.innerHTML="",t.forEach((function(t,r){var n=document.createElement("div");n.classList.add("track-item"),"attachment"===t.type&&n.classList.add("attachment-item");var o=document.createElement("input");o.type="radio",o.name="subtitle-track",o.id="track-".concat(r),o.value=r,0===r&&(o.checked=!0,M.selectedItem=t),o.addEventListener("change",(function(){M.selectedItem=t,document.getElementById("subtitle-preview").innerHTML="",document.getElementById("subtitle-preview-container").style.display="none"}));var i=document.createElement("label");i.htmlFor="track-".concat(r),i.textContent=t.description,n.appendChild(o),n.appendChild(i),e.appendChild(n)})),t.length>0&&(M.selectedItem=t[0])}function d(){return p.apply(this,arguments)}function p(){return(p=l(s().mark((function t(){var e,r,n,i,c,u,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M.currentFile&&M.selectedItem){t.next=2;break}return t.abrupt("return");case 2:if(document.getElementById("loading-indicator").style.display="block",document.getElementById("subtitle-preview-container").style.display="none",t.prev=4,"track"!==M.selectedItem.type){t.next=21;break}return r=M.selectedItem.format.toLowerCase(),n="ass"===r||"ssa"===r?"ass":"srt",t.next=10,fetch("".concat(f,"/api/extract-subtitle"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:M.filename,trackIndex:M.selectedItem.index,format:n})});case 10:if((i=t.sent).ok){t.next=13;break}throw new Error("服务器错误: ".concat(i.status));case 13:return t.next=15,i.json();case 15:if((c=t.sent).success){t.next=18;break}throw new Error(c.error||"提取字幕失败");case 18:e=c.subtitle,t.next=36;break;case 21:if("attachment"!==M.selectedItem.type){t.next=36;break}if(M.selectedItem.isSubtitle){t.next=24;break}throw new Error("选中的附件不是字幕文件");case 24:return r=M.selectedItem.filename.split(".").pop().toLowerCase(),t.next=27,fetch("".concat(f,"/api/extract-attachment"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoFilename:M.filename,attachmentFilename:M.selectedItem.filename})});case 27:if((u=t.sent).ok){t.next=30;break}throw new Error("服务器错误: ".concat(u.status));case 30:return t.next=32,u.json();case 32:if((l=t.sent).success){t.next=35;break}throw new Error(l.error||"提取附件失败");case 35:e=l.content;case 36:if(e){t.next=38;break}throw new Error("无法提取字幕内容");case 38:a(o(e,r)),document.getElementById("subtitle-preview-container").style.display="block",t.next=47;break;case 43:t.prev=43,t.t0=t.catch(4),console.error("预览字幕出错:",t.t0),v("预览字幕时出错，请重试");case 47:return t.prev=47,document.getElementById("loading-indicator").style.display="none",t.finish(47);case 50:case"end":return t.stop()}}),t,null,[[4,43,47,50]])})))).apply(this,arguments)}function y(){return m.apply(this,arguments)}function m(){return(m=l(s().mark((function t(){var e,r,n,o,i,a,c,u,l,h,d,p,y;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M.currentFile&&M.selectedItem){t.next=2;break}return t.abrupt("return");case 2:return document.getElementById("loading-indicator").style.display="block",t.prev=3,n="text/plain","track"===M.selectedItem.type?(o="/api/extract-subtitle",a=M.selectedItem.format.toLowerCase(),c="ass"===a||"ssa"===a?"ass":"srt",i={filename:M.filename,trackIndex:M.selectedItem.index,format:c},r=M.filename.replace(".mkv","")+"_".concat(M.selectedItem.language,".").concat(c)):"attachment"===M.selectedItem.type&&(o="/api/extract-attachment",i={videoFilename:M.filename,attachmentFilename:M.selectedItem.filename},r=M.selectedItem.filename,M.selectedItem.isFont&&(r.endsWith(".ttf")?n="font/ttf":r.endsWith(".otf")&&(n="font/otf"))),t.next=8,fetch("".concat(f).concat(o),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 8:if((u=t.sent).ok){t.next=11;break}throw new Error("服务器错误: ".concat(u.status));case 11:return t.next=13,u.json();case 13:if((l=t.sent).success){t.next=16;break}throw new Error(l.error||"提取失败");case 16:if(!l.outputPath){t.next=21;break}return h=l.outputPath.split(/[\/\\]/).pop(),window.location.href="".concat(f,"/api/download/").concat(h),g("字幕已提取，正在下载..."),t.abrupt("return");case 21:if(e=l.content||l.subtitle){t.next=24;break}throw new Error("无法提取内容");case 24:e?(d="string"==typeof e?new Blob([e],{type:n}):new Blob([e],{type:M.selectedItem.mimetype||n}),p=URL.createObjectURL(d),(y=document.createElement("a")).href=p,y.download=r,y.click(),setTimeout((function(){return URL.revokeObjectURL(p)}),100)):v("提取成功但无法下载文件"),t.next=31;break;case 27:t.prev=27,t.t0=t.catch(3),console.error("提取字幕出错:",t.t0),v("提取字幕时出错，请重试");case 31:return t.prev=31,document.getElementById("loading-indicator").style.display="none",t.finish(31);case 34:case"end":return t.stop()}}),t,null,[[3,27,31,34]])})))).apply(this,arguments)}function v(t){document.getElementById("error-message").textContent=t,document.getElementById("error-container").style.display="block",setTimeout((function(){document.getElementById("error-container").style.display="none"}),3e3)}function g(t){var e=document.getElementById("error-message");e.textContent=t,e.style.color="#4caf50",document.getElementById("error-container").style.display="block",setTimeout((function(){document.getElementById("error-container").style.display="none",e.style.color=""}),3e3)}function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function w(){w=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(e,r,n,o){var i=r&&r.prototype instanceof h?r:h,a=Object.create(i.prototype);return s(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=k(c,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var u=l(e,r,n);if("normal"===u.type){if(o=n.done?4:2,u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=4,n.method="throw",n.arg=u.arg)}}}(e,n,new O(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f={};function h(){}function d(){}function p(){}var y={};s(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(j([])));v&&v!==r&&n.call(v,i)&&(y=v);var g=p.prototype=h.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(o,i,a,c){var s=l(t[o],t,i);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==b(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var o;s(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function k(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function I(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(I,this),this.reset(!0)}function j(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(b(e)+" is not iterable")}return d.prototype=p,s(g,"constructor",p),s(p,"constructor",d),d.displayName=s(p,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},x(E.prototype),s(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(g),s(g,c,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],c=this.prev,s=i[1],u=i[2];if(-1===i[0])return n("end"),!1;if(!s&&!u)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=c){if(c<s)return this.method="next",this.arg=t,n(s),!0;if(c<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:j(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function x(t){return function(t){if(Array.isArray(t))return E(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return E(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function k(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function I(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){k(i,n,o,a,c,"next",t)}function c(t){k(i,n,o,a,c,"throw",t)}a(void 0)}))}}var S="http://localhost:3000";function O(){var t=document.getElementById("file-input"),e=document.getElementById("drop-zone");t.addEventListener("change",j),e.addEventListener("dragover",(function(t){t.preventDefault(),e.classList.add("drag-over")})),e.addEventListener("dragleave",(function(){e.classList.remove("drag-over")})),e.addEventListener("drop",(function(t){t.preventDefault(),e.classList.remove("drag-over"),t.dataTransfer.files.length>0&&T(t.dataTransfer.files[0])})),e.addEventListener("click",(function(){t.click()}))}function j(t){t.target.files.length>0&&T(t.target.files[0])}function T(t){return _.apply(this,arguments)}function _(){return(_=I(w().mark((function t(e){var r,n,o,i,a,c;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.name.toLowerCase().endsWith(".mkv")){t.next=3;break}return L("请选择MKV格式的文件"),t.abrupt("return");case 3:return M.currentFile=e,M.filename=e.name,document.getElementById("file-info").textContent="文件: ".concat(e.name," (").concat((s=e.size)<1024?s+" B":s<1048576?(s/1024).toFixed(2)+" KB":s<1073741824?(s/1048576).toFixed(2)+" MB":(s/1073741824).toFixed(2)+" GB",")"),document.getElementById("file-info-container").style.display="block",document.getElementById("loading-indicator").style.display="block",t.prev=8,console.log("开始分析MKV文件结构..."),console.log("文件名:",e.name),t.next=13,fetch("".concat(S,"/api/analyze-mkv"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:e.name})});case 13:if((r=t.sent).ok){t.next=22;break}return t.next=17,r.json();case 17:if(n=t.sent,404!==r.status){t.next=21;break}throw B(n.mediaDirectories||[]),new Error(n.message||"找不到文件，请设置正确的媒体目录");case 21:throw new Error("服务器错误: ".concat(r.status));case 22:return t.next=24,r.json();case 24:if(o=t.sent,console.log("服务器返回数据:",o),o.success){t.next=28;break}throw new Error(o.error||"解析文件失败");case 28:i=o.tracks,a=o.attachments,M.subtitleTracks=i||[],M.subtitleAttachments=a||[],c=[].concat(x(M.subtitleTracks),x(M.subtitleAttachments)),console.log("解析完成，找到轨道:",M.subtitleTracks.length,"附件:",M.subtitleAttachments.length),h(c),document.getElementById("loading-indicator").style.display="none",c.length>0?document.getElementById("subtitle-tracks-container").style.display="block":L("未在文件中找到字幕轨道或附件"),t.next=43;break;case 38:t.prev=38,t.t0=t.catch(8),console.error("处理文件出错:",t.t0),L("处理文件时出错: ".concat(t.t0.message)),document.getElementById("loading-indicator").style.display="none";case 43:case"end":return t.stop()}var s}),t,null,[[8,38]])})))).apply(this,arguments)}function B(t){return P.apply(this,arguments)}function P(){return(P=I(w().mark((function t(e){var r,n,o,i,a;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="当前配置的媒体目录:\n",0===e.length?r+="- 没有配置目录\n":e.forEach((function(t,e){r+="- ".concat(t,"\n")})),n=prompt('找不到文件"'.concat(M.filename,'"。\n\n')+"".concat(r,"\n")+'请输入文件所在的目录路径，例如"D:\\Videos"\n此设置将保存在服务器上',"")){t.next=5;break}return t.abrupt("return",!1);case 5:return t.prev=5,t.next=8,fetch("".concat(S,"/api/save-media-directory"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({directory:n})});case 8:if((o=t.sent).ok){t.next=14;break}return t.next=12,o.json();case 12:throw i=t.sent,new Error(i.error||"保存目录失败");case 14:return t.next=16,o.json();case 16:if(!(a=t.sent).success){t.next=21;break}return C("已添加目录: ".concat(n)),console.log("更新后的媒体目录列表:",a.mediaDirectories),t.abrupt("return",!0);case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(5),console.error("保存媒体目录出错:",t.t0),L("保存目录失败: ".concat(t.t0.message));case 27:return t.abrupt("return",!1);case 28:case"end":return t.stop()}}),t,null,[[5,23]])})))).apply(this,arguments)}function L(t){document.getElementById("error-message").textContent=t,document.getElementById("error-container").style.display="block",setTimeout((function(){document.getElementById("error-container").style.display="none"}),3e3)}function C(t){var e=document.getElementById("error-message");e.textContent=t,e.style.color="#4caf50",document.getElementById("error-container").style.display="block",setTimeout((function(){document.getElementById("error-container").style.display="none",e.style.color=""}),3e3)}function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function G(){G=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(e,r,n,o){var i=r&&r.prototype instanceof h?r:h,a=Object.create(i.prototype);return s(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=x(c,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var u=l(e,r,n);if("normal"===u.type){if(o=n.done?4:2,u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=4,n.method="throw",n.arg=u.arg)}}}(e,n,new I(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f={};function h(){}function d(){}function p(){}var y={};s(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==r&&n.call(v,i)&&(y=v);var g=p.prototype=h.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(o,i,a,c){var s=l(t[o],t,i);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==F(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var o;s(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function x(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function E(t){this.tryEntries.push(t)}function k(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function I(t){this.tryEntries=[[-1]],t.forEach(E,this),this.reset(!0)}function S(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(F(e)+" is not iterable")}return d.prototype=p,s(g,"constructor",p),s(p,"constructor",d),d.displayName=s(p,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,c,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},b(w.prototype),s(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),s(g,c,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=S,I.prototype={constructor:I,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],c=this.prev,s=i[1],u=i[2];if(-1===i[0])return n("end"),!1;if(!s&&!u)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=c){if(c<s)return this.method="next",this.arg=t,n(s),!0;if(c<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),k(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;k(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:S(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function A(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function N(){var t;return t=G().mark((function t(){return G().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("初始化应用..."),document.getElementById("preview-button").addEventListener("click",d),document.getElementById("extract-button").addEventListener("click",y),O(),console.log("使用本地FFmpeg命令行模式"),document.getElementById("app-loading").style.display="none",document.getElementById("file-select-container").style.display="block",console.log("应用初始化完成，等待用户选择文件...");case 7:case"end":return t.stop()}}),t)})),N=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){A(i,n,o,a,c,"next",t)}function c(t){A(i,n,o,a,c,"throw",t)}a(void 0)}))},N.apply(this,arguments)}document.addEventListener("DOMContentLoaded",(function(){return N.apply(this,arguments)}));var M={currentFile:null,subtitleTracks:[],subtitleAttachments:[],selectedItem:null,ffmpegLoaded:!1,filename:null}})();